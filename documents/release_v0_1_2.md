# Release v0.1.2

> リリース: v0.1.2
>
> コミット:  (worktree snapshot)
> 日付: 2025-12-31

## 概要

v0.1.2 は主に「ログ記録（ロギング）」周りの改善に焦点を当てたパッチリリースです。運用時の可観測性を高めるため、アプリ全体のログをより一貫性のある形式で記録し、トラブルシューティングと監査を容易にしました。

## ハイライト

- **構造化ログの標準化**: 全モジュールでタイムスタンプ／レベル／モジュール名に加え、セッションID（UUID）を安定して出力するようにしました。これにより同一セッションのログ追跡が容易になります。
- **読み込み処理の詳細ログ**: [src/logic/data_io.py](src/logic/data_io.py) の CSV 読み込みで、読み込んだファイルのバイト数・行数・列数に加え、ファイルチェックサム（SHA-256）をログ出力するようにしました。これにより再現性とデータ整合性の確認がしやすくなりました。
- **エクスポート関連のサイズ記録**: エクスポート処理（CSV/Parquet）で出力バイト数を記録し、ユーザー操作後のエクスポート状況を把握できるようにしました（例: `Prepared exports: csv_bytes=... parquet_bytes=...`）。
- **処理開始／終了・所要時間の計測**: 重い処理（ファイル読み込み、ワンホットエンコードなど）に対して開始／終了ログと処理時間（ms）を追加しました。これによりパフォーマンスのボトルネック探索が容易になります。
- **重要イベントの明示的ログ**: [src/logic/feature_engineering.py](src/logic/feature_engineering.py) のワンホットエンコード実行や、[main.py](main.py) のアプリ起動・セッション開始といった重要イベントを INFO レベルで明示的にログ出力するようにしました。
- **ログ出力設定の外部化**: ログレベルやログ書式の設定を環境変数（例: `LOG_LEVEL`）で切り替え可能にし、開発環境と本番環境で運用しやすくしました。
- **ログローテーション/保持**: ログファイルのローテーション（サイズ/日付ベース）設定を導入し、ディスク使用量の制御と古いログの保持方針を改善しました。

## 変更ファイル（主なもの）

- [src/utils/logger.py](src/utils/logger.py) — ログフォーマッタ／ハンドラの統合、セッション/相関IDの自動付与、環境変数による設定読み込み
- [main.py](main.py) — アプリ起動時のセッションID生成とコンテキスト注入
- [src/logic/data_io.py](src/logic/data_io.py) — ファイル読み込み時のチェックサム／行数／列数ログ追加
- [src/ui/export.py](src/ui/export.py) — エクスポート準備完了時のバイト数ログ出力
- [src/logic/feature_engineering.py](src/logic/feature_engineering.py) — ワンホットエンコードなど重要処理の開始ログ

（注: 上記はログに関する変更点の概要です。実際の差分は該当コミットの差分をご参照ください。）

## バグ修正 / 安定化

- ログにセッションIDが含まれないケースを修正し、同一ユーザー／同一セッションのログ追跡が安定しました。
- エクスポート時にサイズが未記録だった問題を修正しました。
- 一部の長時間処理でログ出力が欠落することがあった問題を解消し、開始・終了ログが整備されました。

## 運用上の注意 / 参照コマンド

ロギング設定を変更して実行する例:

```bash
export LOG_LEVEL=INFO
streamlit run main.py
```

ログファイルの確認（デフォルトのログ保存先に依存）:

```bash
tail -n 200 logs/app.log
```

## アップグレード/移行手順

特別な移行手順は不要です。必要に応じて環境変数 `LOG_LEVEL` を設定し、ログ出力先／ローテーション設定を運用ポリシーに合わせて調整してください。

```bash
source .venv/bin/activate
pip install -r requirements.txt
streamlit run main.py
```

## 既知の制限

- 本リリースはログの可観測性改善が中心であり、ログ保存先の外部集約（例: ELK/Cloud Logging）設定は含まれていません。外部ログ集約を行う場合は [src/utils/logger.py](src/utils/logger.py) のハンドラを追加してください。

このリリースノートは現時点のワークツリーに基づく要約です。詳細な実装差分はソースツリーを参照してください。
