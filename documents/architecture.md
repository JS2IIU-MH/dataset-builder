# 機械学習データ前処理アプリ システム構造設計書

## 1. システム全体構成

本システムは、Streamlitを用いたWebアプリケーションとして構築し、データ前処理・分析・可視化・エクスポート機能をGUIで提供する。主な構成要素は以下の通り。

- **UI層**: Streamlitによる画面・操作部（サイドバー、タブ、各種フォーム・グラフ表示）
- **アプリケーション層**: データ処理ロジック（データ入出力、EDA、クリーニング、特徴量エンジニアリング、可視化、コード生成）
- **データ層**: pandas.DataFrame等によるメモリ上のデータ管理

## 2. ディレクトリ構成（推奨）

```
project_root/
├── main.py                # Streamlitエントリポイント
├── src/
│   ├── __init__.py
│   ├── ui/                # UI部品（サイドバー・タブ・フォーム等）
│   ├── logic/             # データ処理ロジック
│   └── utils/             # 汎用ユーティリティ
├── requirements.txt
├── pyproject.toml
└── documents/
    └── requirements.md
```

## 3. モジュール構成

### 3.1 main.py
- Streamlitアプリのエントリポイント。
- サイドバー・タブUIの構築、各機能モジュールの呼び出し。
- st.session_stateによる状態管理。

### 3.2 src/ui/
- sidebar.py: ファイルアップロード、データサイズ表示、リセット・ダウンロードボタン等のUI部品。
- tabs.py: メインエリアのタブ切り替えUI。
- forms.py: 型変換・欠損値処理・特徴量作成等のフォームUI。
- charts.py: グラフ・ヒートマップ等の可視化UI。

### 3.3 src/logic/
- data_io.py: データの入出力（CSV/Parquet読込・書出し）、プレビュー生成。
- eda.py: 基本統計量、欠損値・分布・相関分析等のEDA処理。
- cleaning.py: 型変換、欠損値・重複・外れ値処理。
- feature_engineering.py: 列演算、エンコーディング、スケーリング、日付特徴量抽出。
- codegen.py: 実行した処理のPandasコード自動生成。

### 3.4 src/utils/
- 型判定・変換、エラーハンドリング、共通関数等。

## 4. データフロー

1. サイドバーでCSVファイルをアップロード → pandas.DataFrameとしてメモリ上に保持
2. メインタブで各種処理（EDA/クリーニング/特徴量作成/可視化）を選択・実行
3. 各処理の内容を逐次st.session_stateに記録し、コード生成モジュールにも反映
4. 最終データ・処理コードをエクスポート

## 5. 状態管理

- Streamlitのst.session_stateを用い、
  - アップロード済みデータ
  - 現在の処理内容・履歴
  - UIの選択状態
  を一元管理。
- データリセット時はsession_stateを初期化。

## 6. 例外・エラー処理

- データ読込・処理失敗時はst.error/st.exceptionでユーザー通知。
- 例外発生時もsession_stateの整合性を保つ。

## 7. 拡張性・保守性への配慮

- 機能ごとにロジックを分離し、UI部品もモジュール化。
- 新規処理・可視化・エンコーディング手法等の追加が容易な構成。
- コード生成部は処理履歴をもとに柔軟に拡張可能。

---

この設計により、直感的な操作性・拡張性・再現性を兼ね備えたデータ前処理アプリを実現する。